<template name="matroyshka__partLooper">

	{{#with matroyshkaCurrentNestablePart }}

		<div
			class="container
				{{#if this.width }} width-{{this.width}}{{/if}}
				"
			>
			
			<input type="hidden" value="{{ matroyshkaId }}" />

			<p>Template: <strong>{{ nestableName }}</strong>, type: <em>{{ type }}</em></p>

			<button class="delete-part">Delete this part.</button>
			<button class="move-part" data-move-where="down">Move this part up.</button>
			<button class="move-part" data-move-where="up">Move this part down.</button>
	
			{{#each fields }}

				<p>

					<label for="{{ ../matroyshkaId }}-{{this.name}}">{{ this.name }}:</label> 
					{{#if ifValueEquals this.type "text" }}
						<input id="{{ ../../matroyshkaId }}-{{this.name}}" data-parent-id="{{ ../../matroyshkaId }}" class="matroyshka-save-on-blur" type="text" value="{{ getFieldValue ../../this }}" />
					{{/if}}
					{{#if ifValueEquals this.type "select" }}

						<select id="{{ ../../matroyshkaId }}-{{this.name}}" data-parent-id="{{ ../../matroyshkaId }}" class="matroyshka-save-on-select">

							<option value="not-selected">-</option>

							{{#each selectableData }}

								<option 
									value="{{ name }}" 
									{{#if ifSelectValueEquals ../../../matroyshkaId ../this.name name }} selected="selected"{{/if}}
									>
									{{ name }}
								</option>

							{{/each}}

						</select>

						{{ setActiveSelectValue ../../matroyshkaId ../../this ../name }}

					{{/if}}
				</p>

			{{/each}}

			{{#each fieldsTypeSpecific }}

				{{#if fieldsTypeSpecific__hasFieldsBool ../this }}

					<p><strong>Fields specific to type: {{ this.name }}</strong></p>

					{{#each fieldsTypeSpecific__getFields ../../this }}

						<p>

							<label for="{{ ../../../matroyshkaId }}-{{this.name}}">{{ this.name }}:</label> 
							{{#if ifValueEquals this.type "text" }}
								<input id="{{ ../../../../matroyshkaId }}-{{this.name}}" data-parent-id="{{ ../../../../matroyshkaId }}" class="matroyshka-save-on-blur" type="text" value="{{ getFieldValue ../../../../this }}" />
							{{/if}}
							{{#if ifValueEquals this.type "select" }}

								<select id="{{ ../../../../matroyshkaId }}-{{this.name}}" data-parent-id="{{ ../../../../matroyshkaId }}" class="matroyshka-save-on-select">

									<option value="not-selected">-</option>

									{{#each selectableData }}

										<option 
											value="{{ name }}" 
											{{#if ifSelectValueEquals ../../../../../matroyshkaId ../this.name name }} selected="selected"{{/if}}
											>
											{{ name }}
										</option>

									{{/each}}

								</select>

								{{ setActiveSelectValue ../../../../matroyshkaId ../../../../this ../../../name }}

							{{/if}}
						</p>

					{{/each}}

				{{/if}}

			{{/each}}

			{{#if nestables }}

				<p>
					<strong>Parts of this type:</strong>
				</p>

				<ul>

				{{#each nestables }}

					<li>
						<em>
							{{ name }}:
							<ul>
								{{#each actualNestablesInArray }}

									<li>
										{{ nestableName }}<br />
										<button data-parent-id="{{ ../../matroyshkaId }}" class="add-part">Add <strong>{{ nestableName }}</strong> to <strong>{{ ../../matroyshkaId }}</strong></button>
									</li>

								{{/each}}
							</ul>
						</em>
					</li>

					{{!#each actualNestablesInArray }}

						<h3>All <em>{{ this.name }}</em>'s:</h3>

						{{#each actualNestables ../this }}

							{{{ recurse }}}

						{{/each}}

					{{!/each}}


				{{/each}}

				</ul>

				{{/if}}

		</div>
	
	{{/with}}

</template>
